<!DOCTYPE html><html><head><title>Automated Surveys in Java (Spark)</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="Automated Surveys in Java (Spark)"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">Automated Surveys in Java (Spark)</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Learn to create an automated telephone survey in Java with Twilio.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="Automated Surveys in Java (Spark)" class="chapter"><div data-file="com/twilio/survey/Server.java" class="step"><h2 id="about-this-application">About This Application</h2>
<p>This <a href="http://sparkjava.com">Spark</a> app uses the <a href="https://www.twilio.com/docs/api/twiml">Twilio API</a>
to create an automated survey conducted over SMS or phone call. Callers will
interact with this application over the phone, while you can view the results on a dynamic dashboard.</p>
<p>Check out the source code for this application on <a href="//github.com/TwilioDevEd/automated-survey-spark">GitHub</a>.</p>
<p>In this tutorial, we&#39;ll highlight the code that interacts with Twilio and in
 turn makes the application tick. <a href="//github.com/TwilioDevEd/automated-survey-spark">Check out the project README on GitHub</a>
 to see how to run the code yourself.</p>
<p>Let&#39;s get started! Click the right arrow above to advance to the next code snippet.</p>
<hr>
<p><strong>See also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/docs/java/install">Twilio Java Helper Library</a></li>
<li><a href="https://www.twilio.com/docs/quickstart/java">Twilio Java Quickstart Tutorials</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml">TwiML: The Twilio Markup Language</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml">Spark: Java Web framework</a></li>
<li><a href="https://mongodb.github.io/mongo-java-driver/2.13/getting-started/quick-tour/">MongoDB&#39;s Java Driver</a></li>
<li><a href="http://mongodb.github.io/morphia/">MongoDB&#39;s Morphia Document-Object Mapper</a></li>
<li><a href="https://github.com/google/gson">Google&#39;s Gson JSON-to-Java-Object library</a></li>
</ul>
</div><div data-title="Create a survey" data-file="questions.json" class="step"><h2 id="create-a-survey">Create a survey</h2>
<p>Before we get responses, let&#39;s specify the questions we would like to ask.</p>
<p>Each question is created as a <a href="http://json.org">JSON object</a> with two attributes: 
<code>text</code>, which holds the question we&#39;d like to ask, and <code>type</code>, which describes 
the kind of input we expect a caller to provide when asked that question.</p>
<p>Our app reads this JSON into a Java object using Google&#39;s 
<a href="https://sites.google.com/site/gson/gson-user-guide#TOC-Overview">Gson</a> library.</p>
</div><div data-file="src/main/java/com/twilio/survey/controllers/SurveyController.java" data-highlight="23-41" class="step"><h2 id="accept-a-call">Accept a call</h2>
<p>Every time your Twilio number receives a call or a SMS, Twilio will send an HTTP request
to the application, asking what to do next. The application responds with
<a href="https://www.twilio.com/docs/api/twiml">TwiML</a> that describes the action
(<code>&lt;Say&gt;</code> a phrase, <code>&lt;Gather&gt;</code> input, <code>&lt;Message&gt;</code> a SMS, among others).</p>
<p>First, your Twilio number must be configured to make requests to the
<code>/interview</code> route of this application. Go to your
<a href="//www.twilio.com/console/phone-numbers/">Manage Numbers</a> page, and
set up a new TwiML application using one of your Twilio numbers.</p>
<hr>
<p><strong>See also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/help/faq/twilio-client/how-do-i-create-a-twiml-app">How do I create a TwiML App?</a></li>
</ul>
</div><div data-file="src/main/java/com/twilio/survey/controllers/TwiMLMessageFactory.java" data-highlight="51-95" class="step"><h2 id="ask-a-question">Ask a question</h2>
<p>Once the application receives an HTTP request from Twilio, it used a different
factory depending on if it&#39;s a SMS or a Call generated request to build its 
appropriated TwiML response..</p>
<p>For SMS the application will use &#39;&lt;Message&gt;&#39; verb answer all requests. </p>
<p>In case of Phone call generated requests, the TwiML will contain a a <code>&lt;Say&gt;</code> 
verb for the question&#39;s text, and a <code>&lt;Gather&gt;</code> or <code>&lt;Record&gt;</code> verb to 
collect input based on the question&#39;s type, as specified in <a href="#1">questions.json</a>.</p>
<p>TwiML verbs have properties that allow you to change the way the verb works. 
For example, the <code>&lt;Record&gt;</code> verb always collects audio input, but, using 
the <code>transcribeCallback</code> property, you can specify a route to which Twilio 
will send a transcript of the audio input. For more on TwiML verbs and their 
properties, check out the <a href="https://www.twilio.com/docs/api/twiml">TwiML API documentation</a>.</p>
<hr>
<p><strong>See also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/docs/api/twiml/say">TwiML Voice: &lt;Say&gt;</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/sms/message">TwiML Voice: &lt;Message&gt;</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/record">TwiML Voice: &lt;Record&gt;</a></li>
<li><a href="https://www.twilio.com/docs/api/twiml/gather">TwiML Voice: &lt;Gather&gt;</a></li>
</ul>
</div><div data-file="src/main/java/com/twilio/survey/controllers/SurveyController.java" data-highlight="56-69" class="step"><h2 id="use-a-transcript-of-a-recorded-response">Use a transcript of a recorded response</h2>
<p>When Twilio finishes transcribing a free-form voice response, the application 
finds the corresponding survey, and updates the response for that question to 
include the transcription. This makes it easier to skim the responses without 
listening to the full call.</p>
<hr>
<p><strong>See also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/docs/api/twiml/record">TwiML Voice: &lt;Record&gt;</a></li>
</ul>
</div><div data-file="src/main/java/com/twilio/survey/models/SurveyService.java" data-highlight="51-57" class="step"><h2 id="store-a-caller-s-response">Store a caller&#39;s response</h2>
<p>After each TwiML verb is executed and input is collected, Twilio sends the 
application that input, along with a request for more TwiML. The<br><code>/interview</code> route in our controller handles that input, and passes it to 
the model to update the survey. Using MongoDB&#39;s <a href="http://mongodb.github.io/morphia/">Morphia</a> 
document-object mapper, the question index, responses, and completeness status 
of the survey are updated.</p>
<hr>
<p><strong>See also:</strong></p>
<ul>
<li>Learn about the data provided in <a href="https://www.twilio.com/docs/api/twiml/twilio_request">Twilio&#39;s Request</a></li>
<li>MongoDB&#39;s <a href="http://mongodb.github.io/morphia/1.0/getting-started/quick-tour">Morphia Quick Tour</a></li>
<li>Morphia API: <a href="http://mongodb.github.io/morphia/1.0/javadoc/index.html?org/mongodb/morphia/query/UpdateOperations.html">UpdateOperations</a></li>
<li>Morphia Wiki: <a href="https://github.com/mongodb/morphia/wiki/Datastore">Datastore Interface</a></li>
</ul>
</div><div data-file="src/main/java/com/twilio/survey/controllers/SurveyController.java" data-highlight="44-54" class="step"><h2 id="display-survey-results">Display survey results</h2>
<p>To view the results, the completed surveys are serialized to 
<a href="http://json.org">JSON</a>, which is used to populate the dashboard. The dashboard 
is served on the root (<code>/</code>) URL of the application. We use <a href="http://jquery.com">jQuery</a> 
to call this route via Ajax, and display the results in charts on the home page.</p>
<hr>
<p><strong>See also:</strong></p>
<ul>
<li><a href="https://sites.google.com/site/gson/gson-user-guide#TOC-Overview">Google Gson: Overview</a></li>
<li><a href="http://api.jquery.com/jQuery.ajax/">AJAX requests in jQuery</a></li>
</ul>
</div><div class="step"><h2 id="where-to-next-">Where to next?</h2>
<p>Pat yourself on the back! You&#39;ve finished this tutorial, but there&#39;s much more
good stuff where this came from. If you&#39;re hungry for more ways to work with
Twilio APIs in Java, check out one of the other tutorials, like:</p>
<h3 id="-appointment-reminders-https-www-twilio-com-docs-howto-walkthrough-appointment-reminders-java-spark-"><a href="https://www.twilio.com/docs/howto/walkthrough/appointment-reminders/java/spark">Appointment Reminders</a></h3>
<p>Automate the process of reaching out to your customers in advance of an upcoming
appointment.</p>
<h3 id="did-this-help-">Did this help?</h3>
<p>Thanks for checking this tutorial out! If you have any feedback
to share with us, we&#39;d love to hear it.
<a href="mailto:deved-oss@twilio.com">Contact the Twilio Developer Education Team</a> to let us know what you think.</p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="com/twilio/survey/Server.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnN1cnZleTsKCmltcG9ydCBzdGF0aWMgc3BhcmsuU3BhcmsuKjsKCmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5jb250cm9sbGVycy5TdXJ2ZXlDb250cm9sbGVyOwppbXBvcnQgY29tLnR3aWxpby5zdXJ2ZXkudXRpbC5Db25maWc7CgpwdWJsaWMgY2xhc3MgU2VydmVyIHsKICAvLyBDcmVhdGUgZmllbGQgdG8gaG9sZCBlbnZpcm9ubWVudCBjb25maWd1cmF0aW9uLgogIHB1YmxpYyBzdGF0aWMgQ29uZmlnIGNvbmZpZzsKCiAgLy8gQm9vdHN0cmFwIG91ciBhcHBsaWNhdGlvbgogIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHsKICAgIC8vIFB1bGwgaW4gZW52aXJvbm1lbnQgdmFyaWFibGVzIGZvciBNb25nb0RCIGFuZCBwb3J0IGNvbmZpZ3VyYXRpb24uCiAgICBjb25maWcgPSBuZXcgQ29uZmlnKCk7CgogICAgLy8gY29uZmlndXJlIFNwYXJrIHRvIHVzZSB0aGUgZGVzaXJlZCBwb3J0LgogICAgcG9ydChTZXJ2ZXIuY29uZmlnLmdldFBvcnQoKSk7CgogICAgLy8gTWFwIHJvdXRlcyB0byBjb250cm9sbGVycy4KICAgIHN0YXRpY0ZpbGVMb2NhdGlvbigiL3B1YmxpYyIpOwogICAgcG9zdCgiL2ludGVydmlldyIsIFN1cnZleUNvbnRyb2xsZXIuaW50ZXJ2aWV3KTsKICAgIHBvc3QoIi9pbnRlcnZpZXcvOnBob25lL3RyYW5zY3JpYmUvOnF1ZXN0aW9uIiwgU3VydmV5Q29udHJvbGxlci50cmFuc2NyaWJlKTsKICAgIGdldCgiL3Jlc3VsdHMiLCBTdXJ2ZXlDb250cm9sbGVyLnJlc3VsdHMpOwogICAgCiAgfQp9Cg==</textarea>
<textarea class="saurus-file" data-file="questions.json" data-mode="json">WwogICAgewogICAgICAgICJ0ZXh0IjogIlBsZWFzZSB0ZWxsIHVzIHlvdXIgYWdlLiIsCiAgICAgICAgInR5cGUiOiAibnVtYmVyIgogICAgfSwKICAgIHsKICAgICAgICAidGV4dCI6ICJIYXZlIHlvdSBldmVyIGp1bXAta2lja2VkIGEgbGVtdXI/IiwKICAgICAgICAidHlwZSI6ICJib29sZWFuIgogICAgfSwKICAgIHsKICAgICAgICAidGV4dCI6ICJXaG8gaXMgeW91ciBmYXZvcml0ZSBUZWVuYWdlIE11dGFudCBOaW5qYSBUdXJ0bGUgYW5kIHdoeT8iLAogICAgICAgICJ0eXBlIjogInRleHQiCiAgICB9Cl0=</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/survey/controllers/SurveyController.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnN1cnZleS5jb250cm9sbGVyczsKCmltcG9ydCBqYXZhLmlvLlVuc3VwcG9ydGVkRW5jb2RpbmdFeGNlcHRpb247CmltcG9ydCBqYXZhLm5ldC5VUkxEZWNvZGVyOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKaW1wb3J0IGNvbS5nb29nbGUuZ3Nvbi5Hc29uOwppbXBvcnQgY29tLmdvb2dsZS5nc29uLkpzb25PYmplY3Q7CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5TZXJ2ZXI7CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5tb2RlbHMuUmVzcG9uc2U7CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS5tb2RlbHMuU3VydmV5OwppbXBvcnQgY29tLnR3aWxpby5zdXJ2ZXkubW9kZWxzLlN1cnZleVNlcnZpY2U7CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS51dGlsLkluY29taW5nQ2FsbDsKCmltcG9ydCBzcGFyay5Sb3V0ZTsKCnB1YmxpYyBjbGFzcyBTdXJ2ZXlDb250cm9sbGVyIHsKICBwcml2YXRlIHN0YXRpYyBTdXJ2ZXlTZXJ2aWNlIHN1cnZleXMgPSBuZXcgU3VydmV5U2VydmljZShTZXJ2ZXIuY29uZmlnLmdldE1vbmdvVVJJKCkpOwoKICAvLyBNYWluIGludGVydmlldyBsb29wLgogIHB1YmxpYyBzdGF0aWMgUm91dGUgaW50ZXJ2aWV3ID0gKHJlcXVlc3QsIHJlc3BvbnNlKSAtPiB7CiAgICBNYXA8U3RyaW5nLCBTdHJpbmc+IHBhcmFtZXRlcnMgPSBwYXJzZUJvZHkocmVxdWVzdC5ib2R5KCkpOwogICAgSW5jb21pbmdDYWxsIGNhbGwgPSBJbmNvbWluZ0NhbGwuY3JlYXRlSW5zdGFuY2UocGFyYW1ldGVycyk7CiAgICBBYnN0cmFjdE1lc3NhZ2VGYWN0b3J5IG1lc3NhZ2VGYWN0b3J5ID0gQWJzdHJhY3RNZXNzYWdlRmFjdG9yeS5jcmVhdGVJbnN0YW5jZShwYXJhbWV0ZXJzKTsKCiAgICBTdXJ2ZXkgZXhpc3RpbmdTdXJ2ZXkgPSBzdXJ2ZXlzLmdldFN1cnZleShjYWxsLmdldEZyb20oKSk7CiAgICBpZiAoZXhpc3RpbmdTdXJ2ZXkgPT0gbnVsbCkgewogICAgICBTdXJ2ZXkgc3VydmV5ID0gc3VydmV5cy5jcmVhdGVTdXJ2ZXkoY2FsbC5nZXRGcm9tKCkpOwogICAgICByZXR1cm4gbWVzc2FnZUZhY3RvcnkuZmlyc3RUd2lNTFF1ZXN0aW9uKHN1cnZleSk7CiAgICB9IGVsc2UgaWYgKCFleGlzdGluZ1N1cnZleS5pc0RvbmUoKSkgewogICAgICBleGlzdGluZ1N1cnZleS5hcHBlbmRSZXNwb25zZShuZXcgUmVzcG9uc2UoY2FsbC5nZXRJbnB1dCgpKSk7CiAgICAgIHN1cnZleXMudXBkYXRlU3VydmV5KGV4aXN0aW5nU3VydmV5KTsKICAgICAgaWYgKCFleGlzdGluZ1N1cnZleS5pc0RvbmUoKSkgewogICAgICAgIHJldHVybiBtZXNzYWdlRmFjdG9yeS5uZXh0VHdpTUxRdWVzdGlvbihleGlzdGluZ1N1cnZleSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBtZXNzYWdlRmFjdG9yeS5nb29kQnllVHdpTUxNZXNzYWdlKCk7CiAgfTsKCgogIC8vIFJlc3VsdHMgYWNjZXNzb3Igcm91dGUKICBwdWJsaWMgc3RhdGljIFJvdXRlIHJlc3VsdHMgPSAocmVxdWVzdCwgcmVzcG9uc2UpIC0+IHsKICAgIEdzb24gZ3NvbiA9IG5ldyBHc29uKCk7CiAgICBKc29uT2JqZWN0IGpzb24gPSBuZXcgSnNvbk9iamVjdCgpOwogICAgLy8gQWRkIHF1ZXN0aW9ucyB0byB0aGUgSlNPTiByZXNwb25zZSBvYmplY3QKICAgIGpzb24uYWRkKCJzdXJ2ZXkiLCBnc29uLnRvSnNvblRyZWUoU2VydmVyLmNvbmZpZy5nZXRRdWVzdGlvbnMoKSkpOwogICAgLy8gQWRkIHVzZXIgcmVzcG9uc2VzIHRvIHRoZSBKU09OIHJlc3BvbnNlIG9iamVjdAogICAganNvbi5hZGQoInJlc3VsdHMiLCBnc29uLnRvSnNvblRyZWUoc3VydmV5cy5maW5kQWxsRmluaXNoZWRTdXJ2ZXlzKCkpKTsKICAgIHJlc3BvbnNlLnR5cGUoImFwcGxpY2F0aW9uL2pzb24iKTsKICAgIHJldHVybiBqc29uOwogIH07CgogIC8vIFRyYW5zY3JpcHRpb24gcm91dGUgKGNhbGxlZCBieSBUd2lsaW8ncyBjYWxsYmFjaywgb25jZSB0cmFuc2NyaXB0aW9uIGlzIGNvbXBsZXRlKQogIHB1YmxpYyBzdGF0aWMgUm91dGUgdHJhbnNjcmliZSA9IChyZXF1ZXN0LCByZXNwb25zZSkgLT4gewogICAgSW5jb21pbmdDYWxsIGNhbGwgPSBJbmNvbWluZ0NhbGwuY3JlYXRlSW5zdGFuY2UocGFyc2VCb2R5KHJlcXVlc3QuYm9keSgpKSk7CiAgICAvLyBHZXQgdGhlIHBob25lIGFuZCBxdWVzdGlvbiBudW1iZXJzIGZyb20gdGhlIFVSTCBwYXJhbWV0ZXJzIHByb3ZpZGVkIGJ5IHRoZSAiUmVjb3JkIiB2ZXJiCiAgICBTdHJpbmcgc3VydmV5SWQgPSByZXF1ZXN0LnBhcmFtcygiOnBob25lIik7CiAgICBpbnQgcXVlc3Rpb25JZCA9IEludGVnZXIucGFyc2VJbnQocmVxdWVzdC5wYXJhbXMoIjpxdWVzdGlvbiIpKTsKICAgIC8vIEZpbmQgdGhlIHN1cnZleSBpbiB0aGUgREIuLi4KICAgIFN1cnZleSBzdXJ2ZXkgPSBzdXJ2ZXlzLmdldFN1cnZleShzdXJ2ZXlJZCk7CiAgICAvLyAuLi5hbmQgdXBkYXRlIGl0IHdpdGggb3VyIHRyYW5zY3JpcHRpb24gdGV4dC4KICAgIHN1cnZleS5nZXRSZXNwb25zZXMoKVtxdWVzdGlvbklkXS5zZXRBbnN3ZXIoY2FsbC5nZXRUcmFuc2NyaXB0aW9uVGV4dCgpKTsKICAgIHN1cnZleXMudXBkYXRlU3VydmV5KHN1cnZleSk7CiAgICByZXNwb25zZS5zdGF0dXMoMjAwKTsKICAgIHJldHVybiAiT0siOwogIH07CgogIC8vIEhlbHBlciBtZXRob2RzCgogIC8vIFNwYXJrIGhhcyBubyBidWlsdC1pbiBib2R5IHBhcnNlciwgc28gbGV0J3Mgcm9sbCBvdXIgb3duLgogIHB1YmxpYyBzdGF0aWMgTWFwPFN0cmluZywgU3RyaW5nPiBwYXJzZUJvZHkoU3RyaW5nIGJvZHkpIHRocm93cyBVbnN1cHBvcnRlZEVuY29kaW5nRXhjZXB0aW9uIHsKICAgIFN0cmluZ1tdIHVucGFyc2VkUGFyYW1zID0gYm9keS5zcGxpdCgiJiIpOwogICAgTWFwPFN0cmluZywgU3RyaW5nPiBwYXJzZWRQYXJhbXMgPSBuZXcgSGFzaE1hcDxTdHJpbmcsIFN0cmluZz4oKTsKICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdW5wYXJzZWRQYXJhbXMubGVuZ3RoOyBpKyspIHsKICAgICAgU3RyaW5nW10gcGFyYW0gPSB1bnBhcnNlZFBhcmFtc1tpXS5zcGxpdCgiPSIpOwogICAgICBpZiAocGFyYW0ubGVuZ3RoID09IDIpIHsKICAgICAgICBwYXJzZWRQYXJhbXMucHV0KHVybERlY29kZShwYXJhbVswXSksIHVybERlY29kZShwYXJhbVsxXSkpOwogICAgICB9IGVsc2UgaWYgKHBhcmFtLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgcGFyc2VkUGFyYW1zLnB1dCh1cmxEZWNvZGUocGFyYW1bMF0pLCAiIik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBwYXJzZWRQYXJhbXM7CiAgfQoKICBwdWJsaWMgc3RhdGljIFN0cmluZyB1cmxEZWNvZGUoU3RyaW5nIHMpIHRocm93cyBVbnN1cHBvcnRlZEVuY29kaW5nRXhjZXB0aW9uIHsKICAgIHJldHVybiBVUkxEZWNvZGVyLmRlY29kZShzLCAidXRmLTgiKTsKICB9Cn0K</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/survey/controllers/TwiMLMessageFactory.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnN1cnZleS5jb250cm9sbGVyczsKCmltcG9ydCBqYXZhLmlvLlVuc3VwcG9ydGVkRW5jb2RpbmdFeGNlcHRpb247CmltcG9ydCBqYXZhLm5ldC5VUkxFbmNvZGVyOwoKaW1wb3J0IGNvbS50d2lsaW8uc3VydmV5LlNlcnZlcjsKaW1wb3J0IGNvbS50d2lsaW8uc3VydmV5Lm1vZGVscy5TdXJ2ZXk7CmltcG9ydCBjb20udHdpbGlvLnN1cnZleS51dGlsLlF1ZXN0aW9uOwppbXBvcnQgY29tLnR3aWxpby50d2ltbC4qOwoKcHVibGljIGNsYXNzIFR3aU1MTWVzc2FnZUZhY3RvcnkgZXh0ZW5kcyBBYnN0cmFjdE1lc3NhZ2VGYWN0b3J5IHsKCiAgU3RyaW5nIGZpcnN0VHdpTUxRdWVzdGlvbihTdXJ2ZXkgc3VydmV5KSB0aHJvd3MgVHdpTUxFeGNlcHRpb24sIFVuc3VwcG9ydGVkRW5jb2RpbmdFeGNlcHRpb24gewogICAgVm9pY2VSZXNwb25zZS5CdWlsZGVyIHZvaWNlUmVzcG9uc2VCdWlsZGVyID0gbmV3IFZvaWNlUmVzcG9uc2UuQnVpbGRlcigpCiAgICAgICAgLnNheShuZXcgU2F5LkJ1aWxkZXIoIlRoYW5rcyBmb3IgdGFraW5nIG91ciBzdXJ2ZXkuIikuYnVpbGQoKSk7CgogICAgcmV0dXJuIG5leHRUd2lNTFF1ZXN0aW9uKHN1cnZleSwgdm9pY2VSZXNwb25zZUJ1aWxkZXIpLnRvWG1sKCk7CiAgfQoKICBTdHJpbmcgbmV4dFR3aU1MUXVlc3Rpb24oU3VydmV5IHN1cnZleSkgdGhyb3dzIFR3aU1MRXhjZXB0aW9uLCBVbnN1cHBvcnRlZEVuY29kaW5nRXhjZXB0aW9uIHsKICAgIHJldHVybiBuZXh0VHdpTUxRdWVzdGlvbihzdXJ2ZXksIG51bGwpLnRvWG1sKCk7CiAgfQoKICBwcml2YXRlIFZvaWNlUmVzcG9uc2UgbmV4dFR3aU1MUXVlc3Rpb24oU3VydmV5IHN1cnZleSwgVm9pY2VSZXNwb25zZS5CdWlsZGVyIHR3aW1sKQogICAgICB0aHJvd3MgVHdpTUxFeGNlcHRpb24sIFVuc3VwcG9ydGVkRW5jb2RpbmdFeGNlcHRpb24gewogICAgUXVlc3Rpb24gcXVlc3Rpb24gPSBTZXJ2ZXIuY29uZmlnLmdldFF1ZXN0aW9ucygpW3N1cnZleS5nZXRJbmRleCgpXTsKCiAgICByZXR1cm4gYnVpbGRRdWVzdGlvblR3aU1MKHN1cnZleSwgcXVlc3Rpb24sIHR3aW1sKTsKICB9CgogIHByaXZhdGUgVm9pY2VSZXNwb25zZSBidWlsZFF1ZXN0aW9uVHdpTUwoU3VydmV5IHN1cnZleSwgUXVlc3Rpb24gcXVlc3Rpb24sCiAgICAgIFZvaWNlUmVzcG9uc2UuQnVpbGRlciB0d2ltbCkgdGhyb3dzIFR3aU1MRXhjZXB0aW9uLCBVbnN1cHBvcnRlZEVuY29kaW5nRXhjZXB0aW9uIHsKICAgIFZvaWNlUmVzcG9uc2UuQnVpbGRlciByZXNwb25zZSA9IHR3aW1sICE9IG51bGwgPyB0d2ltbCA6IG5ldyBWb2ljZVJlc3BvbnNlLkJ1aWxkZXIoKTsKICAgIFNheSBzYXkgPSBuZXcgU2F5LkJ1aWxkZXIocXVlc3Rpb24uZ2V0VGV4dCgpKS5idWlsZCgpOwogICAgcmVzcG9uc2Uuc2F5KHNheSk7CiAgICAvLyBEZXBlbmRpbmcgb24gdGhlIHF1ZXN0aW9uIHR5cGUsIGNyZWF0ZSBkaWZmZXJlbnQgVHdpTUwgdmVyYnMuCiAgICBzd2l0Y2ggKHF1ZXN0aW9uLmdldFR5cGUoKSkgewogICAgICBjYXNlICJ0ZXh0IjoKICAgICAgICBhcHBlbmRUZXh0UXVlc3Rpb24oc3VydmV5LCByZXNwb25zZSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImJvb2xlYW4iOgogICAgICAgIGFwcGVuZEJvb2xlYW5RdWVzdGlvbihyZXNwb25zZSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIm51bWJlciI6CiAgICAgICAgYXBwZW5kTnVtYmVyUXVlc3Rpb24ocmVzcG9uc2UpOwogICAgICAgIGJyZWFrOwogICAgfQogICAgcmV0dXJuIHJlc3BvbnNlLmJ1aWxkKCk7CiAgfQoKICBwcml2YXRlIFZvaWNlUmVzcG9uc2UuQnVpbGRlciBhcHBlbmROdW1iZXJRdWVzdGlvbihWb2ljZVJlc3BvbnNlLkJ1aWxkZXIgdHdpbWwpCiAgICAgIHRocm93cyBUd2lNTEV4Y2VwdGlvbiB7CiAgICBTYXkgbnVtSW5zdHJ1Y3Rpb25zID0KICAgICAgICBuZXcgU2F5LkJ1aWxkZXIoIkVudGVyIHRoZSBudW1iZXIgb24geW91ciBrZXlwYWQsIGZvbGxvd2VkIGJ5IHRoZSAjLiIpLmJ1aWxkKCk7CiAgICB0d2ltbC5zYXkobnVtSW5zdHJ1Y3Rpb25zKTsKICAgIC8vIExpc3RlbiB1bnRpbCBhIHVzZXIgcHJlc3NlcyAiIyIKICAgIEdhdGhlciBudW1iZXJHYXRoZXIgPSBuZXcgR2F0aGVyLkJ1aWxkZXIoKS5maW5pc2hPbktleSgiIyIpLmJ1aWxkKCk7CgogICAgdHdpbWwuZ2F0aGVyKG51bWJlckdhdGhlcik7CgogICAgcmV0dXJuIHR3aW1sOwogIH0KCiAgcHJpdmF0ZSBWb2ljZVJlc3BvbnNlLkJ1aWxkZXIgYXBwZW5kQm9vbGVhblF1ZXN0aW9uKFZvaWNlUmVzcG9uc2UuQnVpbGRlciB0d2ltbCkKICAgICAgdGhyb3dzIFR3aU1MRXhjZXB0aW9uIHsKICAgIFNheSBib29sSW5zdHJ1Y3Rpb25zID0KICAgICAgICBuZXcgU2F5LkJ1aWxkZXIoIlByZXNzIDAgdG8gcmVzcG9uZCAnTm8sJyBhbmQgcHJlc3MgYW55IG90aGVyIG51bWJlciB0byByZXNwb25kICdZZXMuJyIpCiAgICAgICAgICAgIC5idWlsZCgpOwogICAgdHdpbWwuc2F5KGJvb2xJbnN0cnVjdGlvbnMpOwoKICAgIC8vIExpc3RlbiBvbmx5IGZvciBvbmUgZGlnaXQuCiAgICBHYXRoZXIgYm9vbGVhbkdhdGhlciA9IG5ldyBHYXRoZXIuQnVpbGRlcigpLm51bURpZ2l0cygxKS5idWlsZCgpOwogICAgdHdpbWwuZ2F0aGVyKGJvb2xlYW5HYXRoZXIpOwoKICAgIHJldHVybiB0d2ltbDsKICB9CgogIHByaXZhdGUgVm9pY2VSZXNwb25zZS5CdWlsZGVyIGFwcGVuZFRleHRRdWVzdGlvbihTdXJ2ZXkgc3VydmV5LCBWb2ljZVJlc3BvbnNlLkJ1aWxkZXIgdHdpbWwpCiAgICAgIHRocm93cyBUd2lNTEV4Y2VwdGlvbiwgVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiB7CgogICAgU2F5IHRleHRJbnN0cnVjdGlvbnMgPSBuZXcgU2F5LkJ1aWxkZXIoCiAgICAgICAgIllvdXIgcmVzcG9uc2Ugd2lsbCBiZSByZWNvcmRlZCBhZnRlciB0aGUgdG9uZS4gT25jZSB5b3UgaGF2ZSBmaW5pc2hlZCByZWNvcmRpbmcsIHByZXNzIHRoZSAjLiIpCiAgICAgICAgICAgIC5idWlsZCgpOwogICAgdHdpbWwuc2F5KHRleHRJbnN0cnVjdGlvbnMpOwogICAgUmVjb3JkIHRleHQgPSBuZXcgUmVjb3JkLkJ1aWxkZXIoKQogICAgICAgIC5maW5pc2hPbktleSgiIyIpCiAgICAgICAgLnRyYW5zY3JpYmUodHJ1ZSkKICAgICAgICAudHJhbnNjcmliZUNhbGxiYWNrKAogICAgICAgICAgICBTdHJpbmcuZm9ybWF0KCIvaW50ZXJ2aWV3LyVzL3RyYW5zY3JpYmUvJXMiLCB1cmxFbmNvZGUoc3VydmV5LmdldFBob25lKCkpLCBzdXJ2ZXkuZ2V0SW5kZXgoKSkKICAgICAgICApLmJ1aWxkKCk7CgogICAgdHdpbWwucmVjb3JkKHRleHQpOwoKICAgIHJldHVybiB0d2ltbDsKICB9CgogIC8vIFdyYXAgdGhlIFVSTEVuY29kZXIgYW5kIFVSTERlY29kZXIgZm9yIGNsZWFubGluZXNzLgogIHByaXZhdGUgU3RyaW5nIHVybEVuY29kZShTdHJpbmcgcykgdGhyb3dzIFVuc3VwcG9ydGVkRW5jb2RpbmdFeGNlcHRpb24gewogICAgcmV0dXJuIFVSTEVuY29kZXIuZW5jb2RlKHMsICJ1dGYtOCIpOwogIH0KCiAgU3RyaW5nIGdvb2RCeWVUd2lNTE1lc3NhZ2UoKSB0aHJvd3MgVHdpTUxFeGNlcHRpb24gewogICAgVm9pY2VSZXNwb25zZSB2b2ljZVJlc3BvbnNlID0gbmV3IFZvaWNlUmVzcG9uc2UuQnVpbGRlcigpCiAgICAgICAgLnNheShuZXcgU2F5LkJ1aWxkZXIoIllvdXIgcmVzcG9uc2VzIGhhdmUgYmVlbiByZWNvcmRlZC4gVGhhbmsgeW91IGZvciB5b3VyIHRpbWUhIikuYnVpbGQoKSkKICAgICAgICAuYnVpbGQoKTsKCiAgICByZXR1cm4gdm9pY2VSZXNwb25zZS50b1htbCgpOwogIH0KfQo=</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/survey/models/SurveyService.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnN1cnZleS5tb2RlbHM7CgppbXBvcnQgamF2YS51dGlsLkxpc3Q7CgppbXBvcnQgb3JnLm1vbmdvZGIubW9ycGhpYS5EYXRhc3RvcmU7CmltcG9ydCBvcmcubW9uZ29kYi5tb3JwaGlhLk1vcnBoaWE7CmltcG9ydCBvcmcubW9uZ29kYi5tb3JwaGlhLnF1ZXJ5LlVwZGF0ZU9wZXJhdGlvbnM7CgppbXBvcnQgY29tLm1vbmdvZGIuTW9uZ29DbGllbnQ7CmltcG9ydCBjb20ubW9uZ29kYi5Nb25nb0NsaWVudFVSSTsKaW1wb3J0IGNvbS50d2lsaW8uc3VydmV5LlNlcnZlcjsKCnB1YmxpYyBjbGFzcyBTdXJ2ZXlTZXJ2aWNlIHsKICAvLyBNb25nb0NsaWVudCBhbmQgTW9ycGhpYSBpbnN0YW5jZXMgbXVzdCBiZSBhY2Nlc3NpYmxlIHRvIHRoZSBlbnRpcmUgb2JqZWN0LCBzbyBhIERhdGFzdG9yZSBjYW4KICAvLyBiZSBidWlsdC4KICBNb25nb0NsaWVudCBtb25nb0NsaWVudDsKICBNb3JwaGlhIG1vcnBoaWE7CgogIC8vIEFuIGluc3RhbmNlIG9mIERhdGFzdG9yZSBtdXN0IGJlIGFjY2Vzc2libGUgdG8gdGhlIGVudGlyZSBvYmplY3QsIHNvIGFsbCBpbnN0YW5jZSBtZXRob2RzIGNhbgogIC8vIHBlcnNpc3QgdG8gYW5kIHJlYWQgZnJvbSB0aGUgZGF0YXN0b3JlLgogIERhdGFzdG9yZSBkYXRhc3RvcmU7CgogIC8vIENvbnN0cnVjdG9yCiAgcHVibGljIFN1cnZleVNlcnZpY2UoTW9uZ29DbGllbnRVUkkgbW9uZ29VUkkpIHsKICAgIHRyeSB7CiAgICAgIC8vIENyZWF0ZSBNb25nb0RCIGRyaXZlcnMKICAgICAgbW9uZ29DbGllbnQgPSBuZXcgTW9uZ29DbGllbnQobW9uZ29VUkkpOwogICAgICBtb3JwaGlhID0gbmV3IE1vcnBoaWEoKTsKCiAgICAgIC8vIEFzayB0aGUgTW9ycGhpYSBkcml2ZXIgdG8gc2NhbiB0aGUgTW9kZWxzIHBhY2thZ2UgZm9yIG1vZGVscy4KICAgICAgbW9ycGhpYS5tYXBQYWNrYWdlKCJjb20udHdpbGlvLnN1cnZleS5tb2RlbHMiKTsKCiAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAvLyBDYXRjaCBhbnkgTW9uZ29EQiBjb25maWd1cmF0aW9uIGVycm9ycywgYW5kIHBhc3MgdGhlbSBiYWNrIHRvIFNUREVSUi4KICAgICAgU3lzdGVtLmVyci5wcmludGxuKGUuZ2V0TWVzc2FnZSgpKTsKICAgIH0gZmluYWxseSB7CiAgICAgIC8vIENyZWF0ZSBhIGRhdGFzdG9yZSB3aXRoIHRoZSBkYXRhYmFzZSBuYW1lIHByb3ZpZGVkLgogICAgICBkYXRhc3RvcmUgPSBtb3JwaGlhLmNyZWF0ZURhdGFzdG9yZShtb25nb0NsaWVudCwgU2VydmVyLmNvbmZpZy5nZXRNb25nb0RCTmFtZSgpKTsKICAgIH0KICB9CgogIHB1YmxpYyBTdXJ2ZXlTZXJ2aWNlKCkgewogICAgdGhpcyhTZXJ2ZXIuY29uZmlnLmdldE1vbmdvVVJJKCkpOwogIH0KCiAgLy8gRmluZCwgVXBkYXRlLCBhbmQgQ3JlYXRlIC0tIGRhdGFiYXNlIG9wZXJhdGlvbnMuCiAgcHVibGljIFN1cnZleSBnZXRTdXJ2ZXkoU3RyaW5nIHBob25lKSB7CiAgICByZXR1cm4gZGF0YXN0b3JlLmZpbmQoU3VydmV5LmNsYXNzKS5maWVsZCgicGhvbmUiKS5lcXVhbChwaG9uZSkuZ2V0KCk7CiAgfQoKICBwdWJsaWMgdm9pZCB1cGRhdGVTdXJ2ZXkoU3VydmV5IHN1cnZleSkgewogICAgVXBkYXRlT3BlcmF0aW9uczxTdXJ2ZXk+IHVwZGF0ZXMgPSBkYXRhc3RvcmUuY3JlYXRlVXBkYXRlT3BlcmF0aW9ucyhTdXJ2ZXkuY2xhc3MpOwogICAgdXBkYXRlcy5zZXQoImluZGV4Iiwgc3VydmV5LmdldEluZGV4KCkpOwogICAgdXBkYXRlcy5zZXQoInJlc3BvbnNlcyIsIHN1cnZleS5nZXRSZXNwb25zZXMoKSk7CiAgICB1cGRhdGVzLnNldCgiZG9uZSIsIHN1cnZleS5pc0RvbmUoKSk7CiAgICBkYXRhc3RvcmUudXBkYXRlKHN1cnZleSwgdXBkYXRlcyk7CiAgfQoKICBwdWJsaWMgU3VydmV5IGNyZWF0ZVN1cnZleShTdHJpbmcgcGhvbmUpIHsKICAgIFN1cnZleSBleGlzdGluZ1N1cnZleSA9IGdldFN1cnZleShwaG9uZSk7CiAgICBpZiAoZXhpc3RpbmdTdXJ2ZXkgPT0gbnVsbCkgewogICAgICBTdXJ2ZXkgc3VydmV5ID0gbmV3IFN1cnZleShwaG9uZSk7CiAgICAgIGRhdGFzdG9yZS5zYXZlKHN1cnZleSk7CiAgICAgIHJldHVybiBzdXJ2ZXk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZXhpc3RpbmdTdXJ2ZXk7CiAgICB9CiAgfQoKICBwdWJsaWMgTGlzdDxTdXJ2ZXk+IGZpbmRBbGxGaW5pc2hlZFN1cnZleXMoKSB7CiAgICByZXR1cm4gZGF0YXN0b3JlLmZpbmQoU3VydmV5LmNsYXNzKS5maWVsZCgiZG9uZSIpLmVxdWFsKHRydWUpLmFzTGlzdCgpOwogIH0KfQo=</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><a href="https://github.com/TwilioDevEd/automated-survey-spark" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>